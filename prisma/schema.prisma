generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id    String  @id @default(auto()) @map("_id") @db.ObjectId
  email String  @unique
  name  String?
}

model InstagramAccount {
  id               String   @id @default(auto()) @map("_id") @db.ObjectId

  // Your app's user id (if you have your own auth)
  ownerUserId      String

  // Meta / Facebook stuff
  fbUserId         String?   // 'me' resolved user id (optional)
  pageId           String?   // Facebook Page id
  igUserId         String?   @unique // Instagram Business/Creator user id

  // Tokens
  accessToken      String?   // long-lived user access token
  tokenExpiresAt   DateTime? // optional: when token expires

  // Basic profile cache
  username         String?
  profileName      String?
  profilePictureUrl String?
  biography        String?
  followersCount   Int?
  mediaCount       Int?

  // Relation to posts
  posts            InstagramPost[]

  lastSyncAt       DateTime? // last time we synced posts/insights

  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  @@index([ownerUserId])
}

model InstagramPost {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  igMediaId      String
  instagramAccountId String @db.ObjectId
  instagramAccount InstagramAccount @relation(fields: [instagramAccountId], references: [id])

  caption        String?
  hashtags       String[]
  mediaType      String?
  mediaUrl       String?
  permalink      String?
  timestamp      DateTime

  // Engagement from media edge
  likeCount      Int?
  commentsCount  Int?

  impressions    Int?
  reach          Int?
  engagement     Int?
  saved          Int?
  views          Int?

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([igMediaId, instagramAccountId], name: "igMediaId_instagramAccountId")
}